/* Copyright 2025 HavenOverflow
 * Use of this code is permissible so long as the appropriate credit
 * is provided. See the LICENSE file for more info.
 */

#include <stdint.h>
#include <string.h>

#include "chip_config.h"
#include "signed_header.h"

/* Leaked with RMASmoke, thank you appleflyer! */
const uint32_t cr50_ro_a_endorsement_seed[512] = {
    0xf7038130, 0x30303030, 0x30303030, 0xef030000, 0x308203eb, 0x308202d3,
    0xa0030201, 0x0202104d, 0xbef7968e, 0x8ea0c4be, 0x3f27bf52, 0xa63fcb30, 
    0x0d06092a, 0x864886f7, 0x0d01010b, 0x05003081, 0x80310b30, 0x09060355,
    0x04061302, 0x55533113, 0x30110603, 0x5504080c, 0x0a43616c, 0x69666f72, 
    0x6e696131, 0x14301206, 0x0355040a, 0x0c0b476f, 0x6f676c65, 0x20496e63, 
    0x2e312430, 0x22060355, 0x040b0c1b, 0x456e6769, 0x6e656572, 0x696e6720,
    0x616e6420, 0x44657665, 0x6c6f706d, 0x656e7431, 0x20301e06, 0x03550403,
    0x0c174352, 0x4f532054, 0x504d2050, 0x52442045, 0x4b20524f, 0x4f542043,
    0x41301e17, 0x0d313931, 0x32303330, 0x30303030, 0x335a170d, 0x32393132,
    0x30333030, 0x30303033, 0x5a300030, 0x82012230, 0x0d06092a, 0x864886f7,
    0x0d010101, 0x05000382, 0x010f0030, 0x82010a02, 0x82010100, 0xc31255bb,
    0xc20d952a, 0xaf127eb0, 0xedbb2c44, 0xedf2be20, 0xc1478b7e, 0x821eca8a,
    0x0d5c47bd, 0x71837361, 0x8375d8de, 0x932b9046, 0x62e05bdb, 0x9cae6d66,
    0x7b56dc2f, 0xd777939e, 0xd5e4b713, 0x55516cf5, 0x6e1c09ee, 0xbd631545,
    0xb7c0f7ca, 0x5c5193a7, 0xfdd09559, 0xe9acc70b, 0x5c50f4d5, 0x62a9ce3f,
    0x877b23ea, 0x496acebf, 0xa6ec2e89, 0x39a9f546, 0x3bff98bc, 0xc9c18cc4,
    0x3fca879b, 0xdb8d4c6b, 0x247280d3, 0xa804a49e, 0x668ae3e9, 0x1dd59b71,
    0x8933398a, 0xc0ee45b1, 0x855f1d89, 0x5df82aad, 0xe89917d9, 0x0e442b6a, 
    0xd729b809, 0x95fa8766, 0x99333b3f, 0x07c0f329, 0xe8b0065c, 0x892afb71,
    0xf97f1e65, 0xacb9c77e, 0x46b44580, 0xf626e0a6, 0x1f53e68f, 0x28385cd9,
    0x4e7eb44a, 0xe2ae7971, 0x79a4ceae, 0xbe13106f, 0x43fc3afe, 0x21ae9deb,
    0x28c515a4, 0x8fab8e38, 0x6c29805d, 0x02030100, 0x01a381df, 0x3081dc30,
    0x0e060355, 0x1d0f0101, 0xff040403, 0x02002030, 0x51060355, 0x1d110101,
    0xff044730, 0x45a44330, 0x41311630, 0x14060567, 0x81050201, 0x0c0b6964,
    0x3a343734, 0x46344634, 0x37310f30, 0x0d060567, 0x81050202, 0x0c044831,
    0x42323116, 0x30140605, 0x67810502, 0x030c0b69, 0x643a3030, 0x31333030,
    0x3337300c, 0x0603551d, 0x130101ff, 0x04023000, 0x30130603, 0x551d2004,
    0x0c300a30, 0x08060667, 0x810c0102, 0x02301f06, 0x03551d23, 0x04183016,
    0x80141539, 0x34fc5919, 0xcd2982f1, 0xf47fad85, 0xd64469a1, 0xa17b3010,
    0x0603551d, 0x25040930, 0x07060567, 0x81050801, 0x30210603, 0x551d0904,
    0x1a301830, 0x16060567, 0x81050210, 0x310d300b, 0x0c03322e, 0x30020100,
    0x02011030, 0x0d06092a, 0x864886f7, 0x0d01010b, 0x05000382, 0x01010034,
    0xa2045296, 0xf40dcb61, 0x1ee11c76, 0x451b5eba, 0x210e721c, 0x72946b99,
    0x7a7d40ac, 0x815d63c2, 0x26954b6b, 0x4016fc0a, 0x5e0deb43, 0xd904e7c8,
    0x5b8981ef, 0x6197f281, 0x1128a789, 0x72346866, 0xc8e9ae89, 0x99dfa853, 
    0x4226fdc1, 0x8a9b2d8f, 0xe510b0fa, 0x88274ca2, 0x38bcdc1b, 0x3280a91e, 
    0x8cf33f81, 0x1a98172f, 0x00d4cc95, 0x9e1a5f8b, 0xe7cfef3c, 0x8062ae2f, 
    0x13018772, 0x68dfbc1b, 0xc948874d, 0x05093b89, 0xac7124c8, 0xafe89de0, 
    0xf5806bcf, 0xb5bb23e0, 0x86ec2a7f, 0x91deffdc, 0xb6185363, 0x889051ed, 
    0xb6306a9d, 0xe9e38b28, 0x58d79189, 0x0a60d1dd, 0x6fadd5a3, 0xa98eafc3, 
    0x1b6a25a9, 0xcb0c47ba, 0xec5221d5, 0x7fd3c9dc, 0xbcc8a723, 0x4c1f9f8f, 
    0x20146efc, 0x5c8deff9, 0x1c8e5af4, 0xb9f5db14, 0x442fd2fc, 0xf158bb6e, 
    0x30168cca, 0xb98e758b, 0x9275f1a7, 0x17a3d42c, 0x03823030, 0x30303030, 
    0x30303024, 0x03000030, 0x82032030, 0x820208a0, 0x03020102, 0x02107136, 
    0xeca7b96f, 0x9ebdc69c, 0x4734e359, 0x2f85300d, 0x06092a86, 0x4886f70d, 
    0x01010b05, 0x00308180, 0x310b3009, 0x06035504, 0x06130255, 0x53311330, 
    0x11060355, 0x04080c0a, 0x43616c69, 0x666f726e, 0x69613114, 0x30120603, 
    0x55040a0c, 0x0b476f6f, 0x676c6520, 0x496e632e, 0x31243022, 0x06035504, 
    0x0b0c1b45, 0x6e67696e, 0x65657269, 0x6e672061, 0x6e642044, 0x6576656c, 
    0x6f706d65, 0x6e743120, 0x301e0603, 0x5504030c, 0x1743524f, 0x53205450, 
    0x4d205052, 0x4420454b, 0x20524f4f, 0x54204341, 0x301e170d, 0x31393132, 
    0x30333030, 0x30303033, 0x5a170d32, 0x39313230, 0x33303030, 0x3030335a, 
    0x30003059, 0x30130607, 0x2a8648ce, 0x3d020106, 0x082a8648, 0xce3d0301, 
    0x07034200, 0x042937ee, 0xcd08b060, 0x1dd77fd1, 0x9bcd249c, 0xda46667c, 
    0x89452916, 0xec255ab1, 0x0d245cc9, 0x3134c5e6, 0x940a11b8, 0xcd5cde9b, 
    0x15149a22, 0x3390d071, 0x55079f33, 0xef8383c1, 0x587ac287, 0x8ba381df, 
    0x3081dc30, 0x0e060355, 0x1d0f0101, 0xff040403, 0x02002030, 0x51060355, 
    0x1d110101, 0xff044730, 0x45a44330, 0x41311630, 0x14060567, 0x81050201, 
    0x0c0b6964, 0x3a343734, 0x46344634, 0x37310f30, 0x0d060567, 0x81050202, 
    0x0c044831, 0x42323116, 0x30140605, 0x67810502, 0x030c0b69, 0x643a3030, 
    0x31333030, 0x3337300c, 0x0603551d, 0x130101ff, 0x04023000, 0x30130603, 
    0x551d2004, 0x0c300a30, 0x08060667, 0x810c0102, 0x02301f06, 0x03551d23, 
    0x04183016, 0x80141539, 0x34fc5919, 0xcd2982f1, 0xf47fad85, 0xd64469a1, 
    0xa17b3010, 0x0603551d, 0x25040930, 0x07060567, 0x81050801, 0x30210603, 
    0x551d0904, 0x1a301830, 0x16060567, 0x81050210, 0x310d300b, 0x0c03322e, 
    0x30020100, 0x02011030, 0x0d06092a, 0x864886f7, 0x0d01010b, 0x05000382, 
    0x0101002e, 0x0e8b832c, 0x2bc26a32, 0xf5031b68, 0x3f5f36e9, 0xe0250a15, 
    0x3ec2c342, 0x8155248f, 0x60247fd6, 0x4c82f5ce, 0xac9475c8, 0x46439b35, 
    0x17c5f47d, 0x6f1f46ed, 0x44040f15, 0xf0372aac, 0x50a389f1, 0x0756dac3, 
    0x39580860, 0x3a1884b5, 0xb03357cf, 0xe0e71f2e, 0x1ed6e2fb, 0x417739ce, 
    0x89beb987, 0x9c9b94ea, 0x7ad872a8, 0xb978dc0b, 0x0cbc560a, 0x6a480ff9, 
    0x4bf12090, 0x8a8bfb09, 0xd8216130, 0x47646973, 0xefd6c1e9, 0xa42e3eeb, 
    0xa0dd59fd, 0xd7f01034, 0xbdcf1800, 0x7222d1dd, 0x26146a79, 0xc4c2ea60, 
    0xdf59822a, 0xddd0867e, 0x2f493e81, 0x99100e9d, 0x63b79efe, 0x237575ee, 
    0xc9a1082d, 0x024ed0d6, 0x52ea700b, 0x686ea8e9, 0xda703c27, 0xf6acd81e, 
    0xd33cae5d, 0xed311ab8, 0x454452ce, 0x8b3b567d, 0x2c3bde1d, 0x302725d3, 
    0x3f343522, 0x377c8b72, 0x309f0a25, 0x38edc35b, 0xff540aff, 0xffffffff, 
    0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 
    0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 
    0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 
    0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 
    0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 
    0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 
    0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 
    0x14c688b2, 0xd95f767f, 0xde319a90, 0x20522a5b, 0x37db5f70, 0x1d2ae149, 
    0xc0a34286, 0x1c74f0c3,
};

void populate_endorsement(void *data)
{
    struct SignedHeader *hdr = (struct SignedHeader *)(data);
    void *out;

    if (hdr->magic == MAGIC_HAVEN) {
        /* Copy the RO_A certificate into the image. */
        out = hdr + CONFIG_RO_SIZE - sizeof(cr50_ro_a_endorsement_seed);
        memcpy(out, cr50_ro_a_endorsement_seed, sizeof(cr50_ro_a_endorsement_seed));
    }
}